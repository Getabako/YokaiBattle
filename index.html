<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¦–æ€ªãƒãƒˆãƒ« - ã‚ãªãŸã®èª²é¡Œã‚’è¦‹ã¤ã‘ã‚ˆã†</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Hiragino Kaku Gothic ProN', 'ãƒ¡ã‚¤ãƒªã‚ª', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #fff;
            overflow-x: hidden;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* ã‚¹ã‚¿ãƒ¼ãƒˆç”»é¢ */
        .screen {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex: 1;
            animation: fadeIn 0.5s ease;
        }

        .screen.active {
            display: flex;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1 {
            font-size: 2.5rem;
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 0 0 20px rgba(255, 100, 100, 0.5);
        }

        .subtitle {
            font-size: 1rem;
            color: #aaa;
            margin-bottom: 40px;
            text-align: center;
        }

        /* ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¿ã‚¤ãƒ—é¸æŠ */
        .user-type-btn {
            width: 100%;
            max-width: 300px;
            padding: 20px;
            margin: 10px 0;
            border: 2px solid #e94560;
            background: rgba(233, 69, 96, 0.1);
            color: #fff;
            font-size: 1.2rem;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .user-type-btn:hover {
            background: rgba(233, 69, 96, 0.3);
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(233, 69, 96, 0.5);
        }

        .user-type-btn .icon {
            font-size: 2rem;
            display: block;
            margin-bottom: 10px;
        }

        .user-type-btn .description {
            font-size: 0.8rem;
            color: #aaa;
        }

        /* åµã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .egg-container {
            position: relative;
            width: 200px;
            height: 250px;
            margin: 30px auto;
        }

        .egg {
            width: 150px;
            height: 200px;
            background: linear-gradient(180deg, #fff 0%, #f0f0f0 50%, #ddd 100%);
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            box-shadow:
                inset -20px -20px 40px rgba(0,0,0,0.1),
                0 10px 30px rgba(0,0,0,0.3);
            transition: all 0.5s ease;
        }

        .egg.cracking {
            animation: shake 0.5s ease-in-out;
        }

        .egg.stage-1 { background: linear-gradient(180deg, #ffe4e4 0%, #ffd0d0 50%, #ffb0b0 100%); }
        .egg.stage-2 { background: linear-gradient(180deg, #ffd0d0 0%, #ffb0b0 50%, #ff9090 100%); }
        .egg.stage-3 { background: linear-gradient(180deg, #ffb0b0 0%, #ff9090 50%, #ff7070 100%); }
        .egg.stage-4 { background: linear-gradient(180deg, #ff9090 0%, #ff7070 50%, #ff5050 100%); }
        .egg.stage-5 { background: linear-gradient(180deg, #ff7070 0%, #ff5050 50%, #ff3030 100%); }

        @keyframes shake {
            0%, 100% { transform: translate(-50%, -50%) rotate(0deg); }
            25% { transform: translate(-50%, -50%) rotate(-5deg); }
            75% { transform: translate(-50%, -50%) rotate(5deg); }
        }

        .egg-glow {
            position: absolute;
            width: 180px;
            height: 230px;
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            background: radial-gradient(ellipse, rgba(233, 69, 96, 0.3) 0%, transparent 70%);
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.5; transform: translate(-50%, -50%) scale(1); }
            50% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
        }

        .progress-bar {
            width: 100%;
            max-width: 300px;
            height: 10px;
            background: rgba(255,255,255,0.2);
            border-radius: 5px;
            overflow: hidden;
            margin: 20px auto;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #e94560, #ff6b6b);
            width: 0%;
            transition: width 0.5s ease;
        }

        .progress-text {
            text-align: center;
            color: #aaa;
            font-size: 0.9rem;
        }

        /* è³ªå•ç”»é¢ */
        .question-container {
            width: 100%;
            max-width: 500px;
        }

        .question-number {
            color: #e94560;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .question-text {
            font-size: 1.3rem;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .answers {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .answer-btn {
            padding: 18px 25px;
            border: 2px solid rgba(255,255,255,0.3);
            background: rgba(255,255,255,0.05);
            color: #fff;
            font-size: 1rem;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
        }

        .answer-btn:hover {
            border-color: #e94560;
            background: rgba(233, 69, 96, 0.2);
            transform: translateX(10px);
        }

        /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ */
        .loading-screen {
            text-align: center;
        }

        .loading-spinner {
            width: 80px;
            height: 80px;
            border: 4px solid rgba(233, 69, 96, 0.3);
            border-top-color: #e94560;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 30px auto;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            color: #e94560;
            font-size: 1.2rem;
            margin-bottom: 10px;
        }

        .loading-subtext {
            color: #aaa;
            font-size: 0.9rem;
        }

        /* å¦–æ€ªç™»å ´ç”»é¢ */
        .yokai-reveal {
            text-align: center;
        }

        .yokai-image {
            width: 280px;
            height: 280px;
            margin: 20px auto;
            position: relative;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 0 40px rgba(233, 69, 96, 0.5);
        }

        .yokai-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            animation: float 3s ease-in-out infinite;
        }

        .yokai-image-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 120px;
            background: linear-gradient(135deg, #2a2a4a 0%, #1a1a3a 100%);
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .yokai-name {
            font-size: 2rem;
            color: #e94560;
            margin: 20px 0 10px;
            text-shadow: 0 0 20px rgba(233, 69, 96, 0.5);
        }

        .yokai-description {
            font-size: 1rem;
            color: #ccc;
            line-height: 1.6;
            margin-bottom: 30px;
            padding: 0 20px;
        }

        .challenge-text {
            background: rgba(233, 69, 96, 0.2);
            border: 1px solid #e94560;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }

        .challenge-title {
            color: #e94560;
            font-size: 1.1rem;
            margin-bottom: 10px;
        }

        .challenge-content {
            font-size: 1rem;
            line-height: 1.6;
        }

        /* æ­¦å™¨/ã‚¢ã‚¤ãƒ†ãƒ è¡¨ç¤º */
        .weapon-container {
            background: linear-gradient(135deg, rgba(100, 200, 255, 0.2) 0%, rgba(50, 150, 255, 0.1) 100%);
            border: 2px solid #64c8ff;
            border-radius: 20px;
            padding: 30px;
            margin: 30px 0;
            text-align: center;
        }

        .weapon-icon {
            font-size: 80px;
            margin-bottom: 15px;
            animation: glow 2s ease-in-out infinite;
        }

        @keyframes glow {
            0%, 100% { filter: drop-shadow(0 0 10px rgba(100, 200, 255, 0.5)); }
            50% { filter: drop-shadow(0 0 30px rgba(100, 200, 255, 0.8)); }
        }

        .weapon-name {
            font-size: 1.5rem;
            color: #64c8ff;
            margin-bottom: 10px;
        }

        .weapon-description {
            color: #aaa;
            line-height: 1.6;
        }

        /* LINEèª˜å° */
        .line-section {
            background: #06c755;
            border-radius: 20px;
            padding: 30px;
            margin: 30px 0;
            text-align: center;
        }

        .line-icon {
            font-size: 50px;
            margin-bottom: 15px;
        }

        .line-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
        }

        .line-description {
            font-size: 0.9rem;
            margin-bottom: 20px;
            opacity: 0.9;
        }

        .line-btn {
            display: inline-block;
            background: #fff;
            color: #06c755;
            padding: 15px 40px;
            border-radius: 30px;
            font-size: 1.1rem;
            font-weight: bold;
            text-decoration: none;
            transition: transform 0.3s ease;
        }

        .line-btn:hover {
            transform: scale(1.05);
        }

        /* é€£çµ¡å…ˆ */
        .contact-info {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            text-align: center;
        }

        .contact-title {
            color: #e94560;
            font-size: 1.1rem;
            margin-bottom: 15px;
        }

        .contact-detail {
            margin: 10px 0;
            color: #ccc;
        }

        .contact-detail a {
            color: #64c8ff;
            text-decoration: none;
        }

        /* ãƒªã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ */
        .restart-btn {
            background: transparent;
            border: 2px solid rgba(255,255,255,0.3);
            color: #fff;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1rem;
            cursor: pointer;
            margin-top: 30px;
            transition: all 0.3s ease;
        }

        .restart-btn:hover {
            border-color: #fff;
            background: rgba(255,255,255,0.1);
        }

        /* å­µåŒ–ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .hatch-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .hatch-animation.active {
            display: flex;
            animation: flashIn 2s ease forwards;
        }

        @keyframes flashIn {
            0% { background: #000; }
            50% { background: #fff; }
            100% { background: transparent; }
        }

        /* è£…é£¾çš„ãªèƒŒæ™¯è¦ç´  */
        .bg-decoration {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            overflow: hidden;
        }

        .floating-kanji {
            position: absolute;
            font-size: 3rem;
            opacity: 0.05;
            animation: floatKanji 20s linear infinite;
        }

        @keyframes floatKanji {
            0% { transform: translateY(100vh) rotate(0deg); }
            100% { transform: translateY(-100px) rotate(360deg); }
        }

        /* ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
        .error-message {
            background: rgba(255, 100, 100, 0.2);
            border: 1px solid #ff6b6b;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            color: #ff6b6b;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="bg-decoration" id="bgDecoration"></div>

    <div class="container">
        <!-- ã‚¹ã‚¿ãƒ¼ãƒˆç”»é¢ -->
        <div class="screen active" id="startScreen">
            <h1>å¦–æ€ªãƒãƒˆãƒ«</h1>
            <p class="subtitle">ã‚ãªãŸã®ä¸­ã«æ½œã‚€èª²é¡ŒãŒå¦–æ€ªã¨ãªã£ã¦ç¾ã‚Œã‚‹...</p>

            <p style="margin-bottom: 20px; color: #aaa;">ã‚ãªãŸã¯ã©ãªãŸã§ã™ã‹?</p>

            <button class="user-type-btn" onclick="selectUserType('child')">
                <span class="icon">ğŸ’</span>
                ãŠå­æ§˜ãƒ»ä¿è­·è€…ã®æ–¹
                <span class="description">ãŠå­æ§˜ã®å­¦ç¿’èª²é¡Œã‚’ç™ºè¦‹ã—ã¾ã™</span>
            </button>

            <button class="user-type-btn" onclick="selectUserType('business')">
                <span class="icon">ğŸ’¼</span>
                ãƒ“ã‚¸ãƒã‚¹ãƒ‘ãƒ¼ã‚½ãƒ³
                <span class="description">AIå°å…¥ã«å‘ã‘ãŸèª²é¡Œã‚’ç™ºè¦‹ã—ã¾ã™</span>
            </button>
        </div>

        <!-- è³ªå•ç”»é¢ -->
        <div class="screen" id="questionScreen">
            <div class="egg-container">
                <div class="egg-glow"></div>
                <div class="egg" id="egg"></div>
            </div>

            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <p class="progress-text" id="progressText">åµãŒæ¸©ã¾ã£ã¦ã„ã¾ã™...</p>

            <div class="question-container">
                <p class="question-number" id="questionNumber"></p>
                <p class="question-text" id="questionText"></p>
                <div class="answers" id="answersContainer"></div>
            </div>
        </div>

        <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ -->
        <div class="screen" id="loadingScreen">
            <div class="loading-screen">
                <div class="loading-spinner"></div>
                <p class="loading-text" id="loadingText">å¦–æ€ªã‚’å¬å–šä¸­...</p>
                <p class="loading-subtext" id="loadingSubtext">ã‚ãªãŸã®å›ç­”ã‚’åˆ†æã—ã¦ã„ã¾ã™</p>
            </div>
        </div>

        <!-- å­µåŒ–ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ -->
        <div class="hatch-animation" id="hatchAnimation"></div>

        <!-- çµæœç”»é¢ -->
        <div class="screen" id="resultScreen">
            <div class="yokai-reveal">
                <h2>å¦–æ€ªãŒç¾ã‚ŒãŸ!</h2>

                <div class="yokai-image" id="yokaiImageContainer">
                    <div class="yokai-image-placeholder" id="yokaiPlaceholder">ğŸ‘»</div>
                </div>

                <h3 class="yokai-name" id="yokaiName"></h3>
                <p class="yokai-description" id="yokaiDescription"></p>

                <div class="challenge-text">
                    <p class="challenge-title">ã‚ãªãŸã®èª²é¡Œ</p>
                    <p class="challenge-content" id="challengeContent"></p>
                </div>

                <div class="weapon-container">
                    <div class="weapon-icon" id="weaponIcon"></div>
                    <h4 class="weapon-name" id="weaponName"></h4>
                    <p class="weapon-description" id="weaponDescription"></p>
                </div>

                <div class="line-section">
                    <div class="line-icon">ğŸ’¬</div>
                    <h4 class="line-title">LINEå‹ã ã¡ç™»éŒ²ç‰¹å…¸</h4>
                    <p class="line-description" id="lineDescription"></p>
                    <a href="#" class="line-btn" id="lineBtn">å‹ã ã¡è¿½åŠ ã™ã‚‹</a>
                </div>

                <div class="contact-info">
                    <h4 class="contact-title" id="contactTitle"></h4>
                    <p class="contact-detail" id="contactDetail"></p>
                </div>

                <button class="restart-btn" onclick="restart()">ã‚‚ã†ä¸€åº¦è¨ºæ–­ã™ã‚‹</button>
            </div>
        </div>
    </div>

    <script>
        // Gemini APIè¨­å®š
        const GEMINI_API_KEY = 'AIzaSyBOawT6aHXNeB6DfCp2TfkEWFEZJmOCkRY';
        const GEMINI_TEXT_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent';
        const GEMINI_IMAGE_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp-image-generation:generateContent';

        // ã‚²ãƒ¼ãƒ ã®çŠ¶æ…‹ç®¡ç†
        let gameState = {
            userType: null,
            currentQuestion: 0,
            answers: [],
            scores: {},
            generatedYokai: null
        };

        // å­ä¾›/ä¿è­·è€…å‘ã‘è³ªå•
        const childQuestions = [
            {
                text: "å‹‰å¼·ä¸­ã€ã©ã‚“ãªã“ã¨ã§å›°ã‚‹ã“ã¨ãŒå¤šã„ã§ã™ã‹?",
                answers: [
                    { text: "é›†ä¸­ãŒç¶šã‹ãªã„", category: "concentration" },
                    { text: "ä½•ã‹ã‚‰å§‹ã‚ã‚Œã°ã„ã„ã‹ã‚ã‹ã‚‰ãªã„", category: "planning" },
                    { text: "è¦šãˆã¦ã‚‚ã™ãå¿˜ã‚Œã¦ã—ã¾ã†", category: "memory" },
                    { text: "ã‚ã‹ã‚‰ãªã„ã¨ã“ã‚ãŒã‚ã‹ã‚‰ãªã„", category: "understanding" }
                ]
            },
            {
                text: "ãƒ†ã‚¹ãƒˆå‰ã®æ°—æŒã¡ã¯?",
                answers: [
                    { text: "ä¸å®‰ã§çœ ã‚Œãªã„", category: "anxiety" },
                    { text: "ãªã‚“ã¨ã‹ãªã‚‹ã¨æ€ã£ã¦ã„ã‚‹", category: "planning" },
                    { text: "ã‚‚ã£ã¨æ—©ãå§‹ã‚ã‚Œã°ã‚ˆã‹ã£ãŸã¨å¾Œæ‚”", category: "planning" },
                    { text: "è‡ªä¿¡ãŒãªã„", category: "confidence" }
                ]
            },
            {
                text: "æˆæ¥­ä¸­ã¯ã©ã‚“ãªæ§˜å­?",
                answers: [
                    { text: "ã¤ã„ä»–ã®ã“ã¨ã‚’è€ƒãˆã¦ã—ã¾ã†", category: "concentration" },
                    { text: "å…ˆç”Ÿã®è©±ãŒé›£ã—ãã¦ã¤ã„ã¦ã„ã‘ãªã„", category: "understanding" },
                    { text: "ãƒãƒ¼ãƒˆã‚’å–ã‚‹ã®ãŒé…ã‚Œã‚‹", category: "memory" },
                    { text: "è³ªå•ã—ãŸã„ã‘ã©æ‰‹ã‚’æŒ™ã’ã‚‰ã‚Œãªã„", category: "confidence" }
                ]
            },
            {
                text: "å®¿é¡Œã¸ã®å–ã‚Šçµ„ã¿æ–¹ã¯?",
                answers: [
                    { text: "ã‚®ãƒªã‚®ãƒªã¾ã§æ‰‹ã‚’ã¤ã‘ãªã„", category: "planning" },
                    { text: "å§‹ã‚ã‚‹ã¾ã§ã«æ™‚é–“ãŒã‹ã‹ã‚‹", category: "concentration" },
                    { text: "ã‚ã‹ã‚‰ãªã„ã¨ã“ã‚ã§æ­¢ã¾ã£ã¦ã—ã¾ã†", category: "understanding" },
                    { text: "ç­”ãˆã‚’è¦‹ã¦ã—ã¾ã†ã“ã¨ãŒã‚ã‚‹", category: "confidence" }
                ]
            },
            {
                text: "å°†æ¥ã®å¤¢ã‚„ç›®æ¨™ã«ã¤ã„ã¦",
                answers: [
                    { text: "ç‰¹ã«æ±ºã¾ã£ã¦ã„ãªã„", category: "planning" },
                    { text: "å¤¢ã¯ã‚ã‚‹ã‘ã©è‡ªä¿¡ãŒãªã„", category: "confidence" },
                    { text: "ä½•ãŒå¾—æ„ã‹ã‚ã‹ã‚‰ãªã„", category: "understanding" },
                    { text: "ã„ã‚ã„ã‚èˆˆå‘³ãŒã‚ã£ã¦æ±ºã‚ã‚‰ã‚Œãªã„", category: "concentration" }
                ]
            }
        ];

        // ãƒ“ã‚¸ãƒã‚¹å‘ã‘è³ªå•
        const businessQuestions = [
            {
                text: "AIå°å…¥ã§ä¸€ç•ªæ°—ã«ãªã‚‹ã“ã¨ã¯?",
                answers: [
                    { text: "ã‚³ã‚¹ãƒˆã¨åŠ¹æœã®ãƒãƒ©ãƒ³ã‚¹", category: "cost" },
                    { text: "ä½•ã‹ã‚‰å§‹ã‚ã‚Œã°ã„ã„ã‹ã‚ã‹ã‚‰ãªã„", category: "strategy" },
                    { text: "ç¤¾å†…ã®ç†è§£ãŒå¾—ã‚‰ã‚Œã‚‹ã‹", category: "culture" },
                    { text: "ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚„ãƒªã‚¹ã‚¯", category: "security" }
                ]
            },
            {
                text: "ç¾åœ¨ã®æ¥­å‹™ã§æœ€ã‚‚èª²é¡Œã«æ„Ÿã˜ã‚‹ã“ã¨ã¯?",
                answers: [
                    { text: "äººæ‰‹ä¸è¶³ãƒ»æ¥­å‹™åŠ¹ç‡åŒ–", category: "efficiency" },
                    { text: "ãƒ‡ãƒ¼ã‚¿æ´»ç”¨ãŒã§ãã¦ã„ãªã„", category: "data" },
                    { text: "æ–°è¦äº‹æ¥­ãƒ»ã‚µãƒ¼ãƒ“ã‚¹é–‹ç™º", category: "innovation" },
                    { text: "é¡§å®¢å¯¾å¿œã®å“è³ªå‘ä¸Š", category: "customer" }
                ]
            },
            {
                text: "ç¤¾å†…ã®ãƒ‡ã‚¸ã‚¿ãƒ«åŒ–ã®çŠ¶æ³ã¯?",
                answers: [
                    { text: "ã»ã¨ã‚“ã©ç´™ãƒ™ãƒ¼ã‚¹", category: "strategy" },
                    { text: "ä¸€éƒ¨ãƒ‡ã‚¸ã‚¿ãƒ«åŒ–ã—ã¦ã„ã‚‹", category: "data" },
                    { text: "ã‹ãªã‚Šé€²ã‚“ã§ã„ã‚‹", category: "innovation" },
                    { text: "ãƒ„ãƒ¼ãƒ«ã¯ã‚ã‚‹ãŒæ´»ç”¨ã§ãã¦ã„ãªã„", category: "culture" }
                ]
            },
            {
                text: "AIå°å…¥ã®äºˆç®—æ„Ÿã¯?",
                answers: [
                    { text: "ã§ãã‚‹ã ã‘ä½ã‚³ã‚¹ãƒˆã§å§‹ã‚ãŸã„", category: "cost" },
                    { text: "åŠ¹æœãŒã‚ã‚Œã°æŠ•è³‡ã™ã‚‹", category: "efficiency" },
                    { text: "ã¾ãšã¯è©¦ã—ã¦ã‹ã‚‰åˆ¤æ–­ã—ãŸã„", category: "strategy" },
                    { text: "äºˆç®—ã¯ç¢ºä¿ã—ã¦ã„ã‚‹", category: "innovation" }
                ]
            },
            {
                text: "AIå°å…¥å¾Œã®é‹ç”¨ã«ã¤ã„ã¦",
                answers: [
                    { text: "å°‚é–€äººæãŒã„ãªã„", category: "culture" },
                    { text: "å¤–éƒ¨ã«ä»»ã›ãŸã„", category: "cost" },
                    { text: "ç¤¾å†…ã§è‚²æˆã—ãŸã„", category: "efficiency" },
                    { text: "ã¾ã è€ƒãˆã¦ã„ãªã„", category: "strategy" }
                ]
            }
        ];

        // èƒŒæ™¯è£…é£¾ã®ç”Ÿæˆ
        function createBgDecoration() {
            const container = document.getElementById('bgDecoration');
            const kanjis = ['å¦–', 'æ€ª', 'é¬¼', 'éœŠ', 'é­”', 'é—˜', 'å‹', 'åŠ›'];

            for (let i = 0; i < 15; i++) {
                const kanji = document.createElement('div');
                kanji.className = 'floating-kanji';
                kanji.textContent = kanjis[Math.floor(Math.random() * kanjis.length)];
                kanji.style.left = Math.random() * 100 + '%';
                kanji.style.animationDelay = Math.random() * 20 + 's';
                kanji.style.animationDuration = (15 + Math.random() * 10) + 's';
                container.appendChild(kanji);
            }
        }

        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¿ã‚¤ãƒ—é¸æŠ
        function selectUserType(type) {
            gameState.userType = type;
            gameState.currentQuestion = 0;
            gameState.answers = [];
            gameState.scores = {};
            gameState.generatedYokai = null;

            showScreen('questionScreen');
            showQuestion();
        }

        // ç”»é¢åˆ‡ã‚Šæ›¿ãˆ
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        // è³ªå•è¡¨ç¤º
        function showQuestion() {
            const questions = gameState.userType === 'child' ? childQuestions : businessQuestions;
            const question = questions[gameState.currentQuestion];

            document.getElementById('questionNumber').textContent =
                `è³ªå• ${gameState.currentQuestion + 1} / ${questions.length}`;
            document.getElementById('questionText').textContent = question.text;

            const answersContainer = document.getElementById('answersContainer');
            answersContainer.innerHTML = '';

            question.answers.forEach((answer, index) => {
                const btn = document.createElement('button');
                btn.className = 'answer-btn';
                btn.textContent = answer.text;
                btn.onclick = () => selectAnswer(answer);
                answersContainer.appendChild(btn);
            });

            // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼æ›´æ–°
            const progress = ((gameState.currentQuestion) / questions.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';

            // åµã®çŠ¶æ…‹æ›´æ–°
            updateEgg();
        }

        // åµã®æ›´æ–°
        function updateEgg() {
            const egg = document.getElementById('egg');
            const questions = gameState.userType === 'child' ? childQuestions : businessQuestions;
            const stage = Math.floor((gameState.currentQuestion / questions.length) * 5);

            egg.className = 'egg';
            if (stage > 0) {
                egg.classList.add('stage-' + stage);
            }
            egg.classList.add('cracking');
            setTimeout(() => egg.classList.remove('cracking'), 500);

            const progressText = document.getElementById('progressText');
            const messages = [
                'åµãŒæ¸©ã¾ã£ã¦ã„ã¾ã™...',
                'ä½•ã‹ãŒå‹•ã„ã¦ã„ã‚‹...',
                'ãƒ’ãƒ“ãŒå…¥ã‚Šå§‹ã‚ãŸ!',
                'ä¸­ã‹ã‚‰éŸ³ãŒèã“ãˆã‚‹...',
                'ã‚‚ã†ã™ãå­µåŒ–ã™ã‚‹!'
            ];
            progressText.textContent = messages[Math.min(stage, messages.length - 1)];
        }

        // å›ç­”é¸æŠ
        function selectAnswer(answer) {
            gameState.answers.push(answer);

            // ã‚¹ã‚³ã‚¢åŠ ç®—
            if (!gameState.scores[answer.category]) {
                gameState.scores[answer.category] = 0;
            }
            gameState.scores[answer.category]++;

            const questions = gameState.userType === 'child' ? childQuestions : businessQuestions;

            if (gameState.currentQuestion < questions.length - 1) {
                gameState.currentQuestion++;
                showQuestion();
            } else {
                // æœ€å¾Œã®è³ªå•ãŒçµ‚ã‚ã£ãŸã‚‰å­µåŒ–ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
                document.getElementById('progressFill').style.width = '100%';
                document.getElementById('progressText').textContent = 'å­µåŒ–ã™ã‚‹!!';

                setTimeout(() => {
                    const hatch = document.getElementById('hatchAnimation');
                    hatch.classList.add('active');

                    setTimeout(() => {
                        hatch.classList.remove('active');
                        showScreen('loadingScreen');
                        generateYokaiWithAI();
                    }, 2000);
                }, 1000);
            }
        }

        // Gemini APIã§å¦–æ€ªã‚’åˆ†æãƒ»ç”Ÿæˆ
        async function generateYokaiWithAI() {
            try {
                // Step 1: å›ç­”ã‚’åˆ†æã—ã¦å¦–æ€ªã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ç”Ÿæˆ
                document.getElementById('loadingText').textContent = 'å›ç­”ã‚’åˆ†æä¸­...';
                document.getElementById('loadingSubtext').textContent = 'ã‚ãªãŸã®èª²é¡Œã‚’ç‰¹å®šã—ã¦ã„ã¾ã™';

                const analysisResult = await analyzeAnswersWithGemini();

                // Step 2: å¦–æ€ªã®ç”»åƒã‚’ç”Ÿæˆ
                document.getElementById('loadingText').textContent = 'å¦–æ€ªã‚’å¬å–šä¸­...';
                document.getElementById('loadingSubtext').textContent = 'ç”»åƒã‚’ç”Ÿæˆã—ã¦ã„ã¾ã™';

                const imageResult = await generateYokaiImage(analysisResult.imagePrompt);

                // çµæœã‚’ä¿å­˜
                gameState.generatedYokai = {
                    ...analysisResult,
                    imageData: imageResult
                };

                showResult();

            } catch (error) {
                console.error('AIç”Ÿæˆã‚¨ãƒ©ãƒ¼:', error);
                // ã‚¨ãƒ©ãƒ¼æ™‚ã¯ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã§è¡¨ç¤º
                gameState.generatedYokai = null;
                showResult();
            }
        }

        // Gemini 2.5 Flashã§å›ç­”ã‚’åˆ†æ
        async function analyzeAnswersWithGemini() {
            const answersText = gameState.answers.map((a, i) => `è³ªå•${i + 1}: ${a.text}`).join('\n');
            const userTypeText = gameState.userType === 'child' ? 'å­ä¾›/å­¦ç”Ÿã®å­¦ç¿’èª²é¡Œ' : 'ãƒ“ã‚¸ãƒã‚¹ãƒ‘ãƒ¼ã‚½ãƒ³ã®AIå°å…¥èª²é¡Œ';

            const prompt = `ã‚ãªãŸã¯æ—¥æœ¬ã®å¦–æ€ªã‚’å‰µé€ ã™ã‚‹ã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼ã§ã™ã€‚
ä»¥ä¸‹ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å›ç­”ã‚’åˆ†æã—ã€ãã®äººã®èª²é¡Œã‚’è±¡å¾´ã™ã‚‹ç‹¬è‡ªã®å¦–æ€ªã‚’å‰µé€ ã—ã¦ãã ã•ã„ã€‚

ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¿ã‚¤ãƒ—ã€‘
${userTypeText}

ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å›ç­”ã€‘
${answersText}

ä»¥ä¸‹ã®JSONå½¢å¼ã§å›ç­”ã—ã¦ãã ã•ã„ï¼ˆJSONã®ã¿ã€èª¬æ˜ä¸è¦ï¼‰:
{
    "yokaiName": "å¦–æ€ªã®åå‰ï¼ˆæ—¥æœ¬èªã€ãƒ¦ãƒ‹ãƒ¼ã‚¯ã§å°è±¡çš„ãªåå‰ï¼‰",
    "yokaiDescription": "å¦–æ€ªã®èª¬æ˜ï¼ˆ50æ–‡å­—ç¨‹åº¦ã€ã©ã‚“ãªåŠ›ã‚’æŒã¡ä½•ã‚’ã™ã‚‹å¦–æ€ªã‹ï¼‰",
    "challenge": "ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®èª²é¡Œï¼ˆ80æ–‡å­—ç¨‹åº¦ã€è¨ºæ–­çµæœã¨ã—ã¦ï¼‰",
    "weapon": "èª²é¡Œã‚’å…‹æœã™ã‚‹ãŸã‚ã®æ­¦å™¨/ã‚¢ã‚¤ãƒ†ãƒ ã®åå‰",
    "weaponIcon": "æ­¦å™¨ã‚’è¡¨ã™çµµæ–‡å­—1ã¤",
    "weaponDescription": "${gameState.userType === 'child' ? 'if(å¡¾)' : 'if(business)'}ã§å¾—ã‚‰ã‚Œã‚‹å…·ä½“çš„ãªãƒ¡ãƒªãƒƒãƒˆï¼ˆ50æ–‡å­—ç¨‹åº¦ï¼‰",
    "imagePrompt": "å¦–æ€ªã®å¤–è¦‹ã‚’æå†™ã™ã‚‹è‹±èªã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆJapanese yokai monster style, cute but slightly scary, representing the concept of [èª²é¡Œã‚’è‹±èªã§], colorful, detailed, anime styleï¼‰"
}`;

            const response = await fetch(`${GEMINI_TEXT_URL}?key=${GEMINI_API_KEY}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    contents: [{
                        parts: [{ text: prompt }]
                    }],
                    generationConfig: {
                        temperature: 0.9,
                        topK: 40,
                        topP: 0.95,
                        maxOutputTokens: 1024,
                    }
                })
            });

            if (!response.ok) {
                throw new Error('Gemini API error: ' + response.status);
            }

            const data = await response.json();
            const text = data.candidates[0].content.parts[0].text;

            // JSONã‚’æŠ½å‡ºã—ã¦ãƒ‘ãƒ¼ã‚¹
            const jsonMatch = text.match(/\{[\s\S]*\}/);
            if (!jsonMatch) {
                throw new Error('JSON not found in response');
            }

            return JSON.parse(jsonMatch[0]);
        }

        // Gemini 2.0 Flash Image Generationã§å¦–æ€ªç”»åƒã‚’ç”Ÿæˆ
        async function generateYokaiImage(imagePrompt) {
            const fullPrompt = `Generate an image: Japanese yokai supernatural creature - ${imagePrompt}. Style: Japanese traditional yokai art mixed with modern anime, vibrant colors, mystical atmosphere, slightly cute but mysterious, game character design, high quality, detailed illustration`;

            const response = await fetch(`${GEMINI_IMAGE_URL}?key=${GEMINI_API_KEY}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    contents: [{
                        parts: [{ text: fullPrompt }]
                    }],
                    generationConfig: {
                        responseModalities: ["IMAGE", "TEXT"]
                    }
                })
            });

            if (!response.ok) {
                const errorText = await response.text();
                console.error('Image API error:', errorText);
                throw new Error('Image generation failed: ' + response.status);
            }

            const data = await response.json();

            // ç”»åƒãƒ‡ãƒ¼ã‚¿ã‚’æ¢ã™
            if (data.candidates && data.candidates[0] && data.candidates[0].content && data.candidates[0].content.parts) {
                for (const part of data.candidates[0].content.parts) {
                    if (part.inlineData && part.inlineData.data) {
                        return {
                            mimeType: part.inlineData.mimeType || 'image/png',
                            data: part.inlineData.data
                        };
                    }
                }
            }

            throw new Error('No image data in response');
        }

        // çµæœè¡¨ç¤º
        function showResult() {
            const yokaiImageContainer = document.getElementById('yokaiImageContainer');

            if (gameState.generatedYokai && gameState.generatedYokai.imageData) {
                // AIç”Ÿæˆã•ã‚ŒãŸå¦–æ€ªã‚’è¡¨ç¤º
                const yokai = gameState.generatedYokai;

                // ç”»åƒã‚’è¡¨ç¤º
                yokaiImageContainer.innerHTML = `<img src="data:${yokai.imageData.mimeType};base64,${yokai.imageData.data}" alt="${yokai.yokaiName}">`;

                document.getElementById('yokaiName').textContent = yokai.yokaiName;
                document.getElementById('yokaiDescription').textContent = yokai.yokaiDescription;
                document.getElementById('challengeContent').textContent = yokai.challenge;
                document.getElementById('weaponIcon').textContent = yokai.weaponIcon;
                document.getElementById('weaponName').textContent = yokai.weapon;
                document.getElementById('weaponDescription').textContent = yokai.weaponDescription;

            } else {
                // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: å¾“æ¥ã®å›ºå®šå¦–æ€ªã‚’ä½¿ç”¨
                showFallbackResult();
            }

            // LINEç‰¹å…¸ã¨é€£çµ¡å…ˆ
            if (gameState.userType === 'child') {
                document.getElementById('lineDescription').textContent =
                    'ä»Šã™ãå‹ã ã¡è¿½åŠ ã§ã€Œå­¦ç¿’ã‚¿ã‚¤ãƒ—è¨ºæ–­ã‚·ãƒ¼ãƒˆã€ã¨ã€Œé›†ä¸­åŠ›ã‚¢ãƒƒãƒ—è¡“ã€ã‚’ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆ!';
                document.getElementById('lineBtn').href = 'https://line.me/R/ti/p/@your-juku-id';
                document.getElementById('contactTitle').textContent = 'if(å¡¾)ã¸ã®ãŠå•ã„åˆã‚ã›';
                document.getElementById('contactDetail').innerHTML =
                    'ç„¡æ–™ä½“é¨“æˆæ¥­å—ä»˜ä¸­!<br><a href="tel:0120-xxx-xxx">0120-XXX-XXX</a><br>ãŠæ°—è»½ã«ã”ç›¸è«‡ãã ã•ã„';
            } else {
                document.getElementById('lineDescription').textContent =
                    'ä»Šã™ãå‹ã ã¡è¿½åŠ ã§ã€ŒAIå°å…¥ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã€ã¨ã€Œæ¥­ç•Œåˆ¥æ´»ç”¨äº‹ä¾‹é›†ã€ã‚’ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆ!';
                document.getElementById('lineBtn').href = 'https://line.me/R/ti/p/@your-business-id';
                document.getElementById('contactTitle').textContent = 'if(business)ã¸ã®ãŠå•ã„åˆã‚ã›';
                document.getElementById('contactDetail').innerHTML =
                    'ç„¡æ–™AIå°å…¥ç›¸è«‡å—ä»˜ä¸­!<br><a href="mailto:contact@if-business.com">contact@if-business.com</a><br>ãŠæ°—è»½ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„';
            }

            showScreen('resultScreen');
        }

        // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”¨ã®å›ºå®šå¦–æ€ªãƒ‡ãƒ¼ã‚¿
        const fallbackYokais = {
            child: {
                concentration: { name: "æ•£æ¼«å¦–æ€ªã€Œãƒ•ãƒ¯ãƒ•ãƒ¯ã€", emoji: "ğŸ‘»", description: "é›†ä¸­åŠ›ã‚’å¥ªã„ã€æ°—ã‚’æ•£ã‚‰ã›ã‚‹å¦–æ€ªã€‚", challenge: "é›†ä¸­åŠ›ãŒç¶šã‹ãšã€å‹‰å¼·ã«èº«ãŒå…¥ã‚‰ãªã„çŠ¶æ…‹ã§ã™ã€‚", weapon: "é›†ä¸­ã®å‰£", weaponIcon: "âš”ï¸", weaponDescription: "ifã®å€‹åˆ¥æŒ‡å°ã§é›†ä¸­ã§ãã‚‹å­¦ç¿’æ³•ã‚’èº«ã«ã¤ã‘ã‚ˆã†!" },
                planning: { name: "å…ˆå»¶ã°ã—å¦–æ€ªã€Œã‚¢ãƒˆãƒ‡ã€", emoji: "ğŸ¦¥", description: "ã€Œæ˜æ—¥ã‚„ã‚ã†ã€ã®å‘ªæ–‡ã‚’å”±ãˆã‚‹å¦–æ€ªã€‚", challenge: "è¨ˆç”»çš„ã«å­¦ç¿’ã‚’é€²ã‚ã‚‹ã“ã¨ãŒè‹¦æ‰‹ã§ã™ã€‚", weapon: "è¨ˆç”»ã®ç›¾", weaponIcon: "ğŸ›¡ï¸", weaponDescription: "ifã®å­¦ç¿’è¨ˆç”»ã‚µãƒãƒ¼ãƒˆã§ç¿’æ…£ã¥ãã‚Šã‚’!" },
                memory: { name: "å¿˜å´å¦–æ€ªã€Œãƒ¯ã‚¹ãƒ¬ãƒ³ãƒœã‚¦ã€", emoji: "ğŸŒ«ï¸", description: "è¦šãˆãŸçŸ¥è­˜ã‚’æ¶ˆã—å»ã‚‹å¦–æ€ªã€‚", challenge: "æš—è¨˜ã‚„å¾©ç¿’ã®æ–¹æ³•ã«èª²é¡ŒãŒã‚ã‚Šã¾ã™ã€‚", weapon: "è¨˜æ†¶ã®æ–", weaponIcon: "ğŸª„", weaponDescription: "ifã®åå¾©å­¦ç¿’ã§è¨˜æ†¶ã®å®šç€ã‚’!" },
                understanding: { name: "è¿·å®®å¦–æ€ªã€ŒãƒŠã‚¾ãƒŠã‚¾ã€", emoji: "ğŸŒ€", description: "å•é¡Œã®æœ¬è³ªã‚’è¦‹ãˆãªãã™ã‚‹å¦–æ€ªã€‚", challenge: "ç†è§£ã®åœŸå°ã¨ãªã‚‹åŸºç¤ã«èª²é¡ŒãŒã‚ã‚Šã¾ã™ã€‚", weapon: "ç†è§£ã®éµ", weaponIcon: "ğŸ”‘", weaponDescription: "ifã®ä¸å¯§ãªè§£èª¬ã§ã€Œã‚ã‹ã£ãŸ!ã€ã‚’!" },
                confidence: { name: "è‡ªä¿¡å–ªå¤±å¦–æ€ªã€Œãƒ‡ã‚­ãƒŠã‚¤ã€", emoji: "ğŸ˜°", description: "ã€Œã©ã†ã›ç„¡ç†ã€ã®å‘ªã„ã‚’ã‹ã‘ã‚‹å¦–æ€ªã€‚", challenge: "è‡ªå·±è‚¯å®šæ„ŸãŒä¸‹ãŒã£ã¦ã„ã¾ã™ã€‚", weapon: "å‹‡æ°—ã®ç‚", weaponIcon: "ğŸ”¥", weaponDescription: "ifã®è¤’ã‚ã‚‹æŒ‡å°ã§è‡ªä¿¡ã‚’!" },
                anxiety: { name: "ä¸å®‰å¦–æ€ªã€Œã‚·ãƒ³ãƒ‘ã‚¤ã€", emoji: "ğŸ˜¨", description: "å¿ƒé…äº‹ã‚’è†¨ã‚‰ã¾ã›ã‚‹å¦–æ€ªã€‚", challenge: "ãƒ—ãƒ¬ãƒƒã‚·ãƒ£ãƒ¼ã«å¼±ã„çŠ¶æ…‹ã§ã™ã€‚", weapon: "å®‰å¿ƒã®å…‰", weaponIcon: "âœ¨", weaponDescription: "ifã®ãƒ¡ãƒ³ã‚¿ãƒ«ã‚µãƒãƒ¼ãƒˆã§æœ¬ç•ªã«å¼·ã!" }
            },
            business: {
                cost: { name: "ã‚³ã‚¹ãƒˆå¦–æ€ªã€Œã‚¿ã‚«ã‚¤ã‚¿ã‚«ã‚¤ã€", emoji: "ğŸ’°", description: "æŠ•è³‡åˆ¤æ–­ã‚’éˆã‚‰ã›ã‚‹å¦–æ€ªã€‚", challenge: "AIå°å…¥ã®ã‚³ã‚¹ãƒˆã«ä¸å®‰ãŒã‚ã‚Šã¾ã™ã€‚", weapon: "ROIå¯è¦–åŒ–ãƒ„ãƒ¼ãƒ«", weaponIcon: "ğŸ“Š", weaponDescription: "ifã®ã‚³ãƒ³ã‚µãƒ«ã§æŠ•è³‡å¯¾åŠ¹æœã‚’æ˜ç¢ºã«!" },
                strategy: { name: "æˆ¦ç•¥è¿·å­å¦–æ€ªã€Œãƒ‰ã‚³ã‚«ãƒ©ã€", emoji: "ğŸ—ºï¸", description: "AIå°å…¥ã®é“ç­‹ã‚’è¦‹ãˆãªãã™ã‚‹å¦–æ€ªã€‚", challenge: "ä½•ã‹ã‚‰å§‹ã‚ã‚Œã°ã„ã„ã‹è¿·ã£ã¦ã„ã¾ã™ã€‚", weapon: "AIãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—", weaponIcon: "ğŸ§­", weaponDescription: "ifã®AIå°å…¥æˆ¦ç•¥ã‚³ãƒ³ã‚µãƒ«ã‚’!" },
                culture: { name: "çµ„ç¹”å¦–æ€ªã€Œã‚½ãƒ³ãƒŠãƒãƒ ãƒªã€", emoji: "ğŸ¢", description: "å¤‰åŒ–ã‚’æ‹’ã‚€ç©ºæ°—ã‚’ä½œã‚‹å¦–æ€ªã€‚", challenge: "ç¤¾å†…ã®ç†è§£ã«èª²é¡ŒãŒã‚ã‚Šã¾ã™ã€‚", weapon: "ãƒã‚§ãƒ³ã‚¸ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆ", weaponIcon: "ğŸ¤", weaponDescription: "ifã®çµ„ç¹”å¤‰é©æ”¯æ´ã‚’!" },
                security: { name: "ãƒªã‚¹ã‚¯å¦–æ€ªã€Œã‚¢ãƒ–ãƒŠã‚¤ã€", emoji: "âš ï¸", description: "ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸å®‰ã‚’å¢—å¤§ã•ã›ã‚‹å¦–æ€ªã€‚", challenge: "ãƒªã‚¹ã‚¯ç®¡ç†ã«ä¸å®‰ãŒã‚ã‚Šã¾ã™ã€‚", weapon: "ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¬ã‚¤ãƒ‰", weaponIcon: "ğŸ”’", weaponDescription: "ifã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚³ãƒ³ã‚µãƒ«ã‚’!" },
                efficiency: { name: "éåŠ¹ç‡å¦–æ€ªã€Œãƒ ãƒ€ãƒ ãƒ€ã€", emoji: "ğŸŒ", description: "æ¥­å‹™ã®ç„¡é§„ã‚’è¦‹ãˆãªãã™ã‚‹å¦–æ€ªã€‚", challenge: "æ¥­å‹™åŠ¹ç‡åŒ–ã®ä½™åœ°ãŒå¤§ãã„ã§ã™ã€‚", weapon: "æ¥­å‹™è‡ªå‹•åŒ–ãƒ„ãƒ¼ãƒ«", weaponIcon: "âš¡", weaponDescription: "ifã®AIè‡ªå‹•åŒ–ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚’!" },
                data: { name: "ãƒ‡ãƒ¼ã‚¿å¦–æ€ªã€Œãƒ¢ãƒƒã‚¿ã‚¤ãƒŠã‚¤ã€", emoji: "ğŸ“¦", description: "ãƒ‡ãƒ¼ã‚¿ã®ä¾¡å€¤ã‚’çœ ã‚‰ã›ã‚‹å¦–æ€ªã€‚", challenge: "ãƒ‡ãƒ¼ã‚¿æ´»ç”¨ãŒã§ãã¦ã„ã¾ã›ã‚“ã€‚", weapon: "ãƒ‡ãƒ¼ã‚¿æ´»ç”¨åŸºç›¤", weaponIcon: "ğŸ’", weaponDescription: "ifã®ãƒ‡ãƒ¼ã‚¿åˆ†æã‚µãƒ¼ãƒ“ã‚¹ã‚’!" },
                innovation: { name: "åœæ»å¦–æ€ªã€Œã‚¤ãƒãƒãƒ‡ãƒ‰ã‚ªãƒªã€", emoji: "ğŸ”„", description: "ç¾çŠ¶ç¶­æŒã®åŠ›ã‚’å¼·ã‚ã‚‹å¦–æ€ªã€‚", challenge: "æ–°è¦äº‹æ¥­å‰µå‡ºã«èª²é¡ŒãŒã‚ã‚Šã¾ã™ã€‚", weapon: "ã‚¤ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³æ‰‹æ³•", weaponIcon: "ğŸ’¡", weaponDescription: "ifã®ã‚¤ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³æ”¯æ´ã‚’!" },
                customer: { name: "é¡§å®¢é›¢ã‚Œå¦–æ€ªã€Œã‚µãƒ¨ãƒŠãƒ©ã€", emoji: "ğŸ‘‹", description: "é¡§å®¢æº€è¶³åº¦ã‚’ä¸‹ã’ã‚‹å¦–æ€ªã€‚", challenge: "é¡§å®¢å¯¾å¿œå“è³ªã«èª²é¡ŒãŒã‚ã‚Šã¾ã™ã€‚", weapon: "AIé¡§å®¢å¯¾å¿œ", weaponIcon: "ğŸ¯", weaponDescription: "ifã®AIãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã‚’!" }
            }
        };

        function showFallbackResult() {
            // æœ€ã‚‚ã‚¹ã‚³ã‚¢ãŒé«˜ã„ã‚«ãƒ†ã‚´ãƒªã‚’ç‰¹å®š
            let maxCategory = null;
            let maxScore = 0;

            for (const category in gameState.scores) {
                if (gameState.scores[category] > maxScore) {
                    maxScore = gameState.scores[category];
                    maxCategory = category;
                }
            }

            const yokaiData = gameState.userType === 'child' ? fallbackYokais.child : fallbackYokais.business;
            const defaultCategory = gameState.userType === 'child' ? 'concentration' : 'strategy';
            const yokai = yokaiData[maxCategory] || yokaiData[defaultCategory];

            const yokaiImageContainer = document.getElementById('yokaiImageContainer');
            yokaiImageContainer.innerHTML = `<div class="yokai-image-placeholder">${yokai.emoji}</div>`;

            document.getElementById('yokaiName').textContent = yokai.name;
            document.getElementById('yokaiDescription').textContent = yokai.description;
            document.getElementById('challengeContent').textContent = yokai.challenge;
            document.getElementById('weaponIcon').textContent = yokai.weaponIcon;
            document.getElementById('weaponName').textContent = yokai.weapon;
            document.getElementById('weaponDescription').textContent = yokai.weaponDescription;
        }

        // ãƒªã‚¹ã‚¿ãƒ¼ãƒˆ
        function restart() {
            gameState = {
                userType: null,
                currentQuestion: 0,
                answers: [],
                scores: {},
                generatedYokai: null
            };
            showScreen('startScreen');
        }

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', () => {
            createBgDecoration();
        });
    </script>
</body>
</html>
